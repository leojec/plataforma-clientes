{"ast":null,"code":"import _objectSpread from\"/Users/leonardorocha/Documents/TCC/projeto/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useEffect}from'react';import{api}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function useAuth(){const context=useContext(AuthContext);if(!context){throw new Error('useAuth deve ser usado dentro de um AuthProvider');}return context;}export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const token=localStorage.getItem('token');if(token){api.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser({token});}setLoading(false);},[]);const login=async(email,senha)=>{try{const response=await api.post('/auth/login',{email,senha});const{token,usuario}=response.data;localStorage.setItem('token',token);api.defaults.headers.common['Authorization']=\"Bearer \".concat(token);setUser(_objectSpread(_objectSpread({},usuario),{},{token}));return{success:true};}catch(error){var _error$response,_error$response2,_error$response3,_error$response4,_error$config2;let errorMessage='Erro ao fazer login';if(error.isHtmlResponse||(_error$response=error.response)!==null&&_error$response!==void 0&&_error$response.data&&typeof error.response.data==='string'&&error.response.data.trim().startsWith('<!')){var _error$config;errorMessage='API retornou HTML ao invés de JSON. Verifique a URL base e o endpoint.';console.error('❌ Erro: API retornou HTML. URL:',(_error$config=error.config)===null||_error$config===void 0?void 0:_error$config.url);console.error('❌ Base URL:',api.defaults.baseURL);}else if((_error$response2=error.response)!==null&&_error$response2!==void 0&&_error$response2.data){const errorData=error.response.data;if(typeof errorData==='string'){errorMessage=errorData;}else if(errorData&&typeof errorData==='object'){errorMessage=errorData.message||errorData.error||'Erro de conexão com o servidor';}else{errorMessage='Erro de conexão com o servidor';}}else if(error.message&&typeof error.message==='string'){errorMessage=error.message;}else if(error.code==='ECONNABORTED'){errorMessage='Timeout ao conectar com o servidor. Verifique sua conexão.';}else if(!error.response){errorMessage='Não foi possível conectar ao servidor. Verifique a URL da API.';}console.error('❌ Erro no login:',{message:error.message,response:(_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.data,status:(_error$response4=error.response)===null||_error$response4===void 0?void 0:_error$response4.status,url:(_error$config2=error.config)===null||_error$config2===void 0?void 0:_error$config2.url,baseURL:api.defaults.baseURL});return{success:false,message:errorMessage};}};const logout=()=>{localStorage.removeItem('token');delete api.defaults.headers.common['Authorization'];setUser(null);};const value={user,login,logout,loading};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","api","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","localStorage","getItem","defaults","headers","common","concat","login","email","senha","response","post","usuario","data","setItem","_objectSpread","success","error","_error$response","_error$response2","_error$response3","_error$response4","_error$config2","errorMessage","isHtmlResponse","trim","startsWith","_error$config","console","config","url","baseURL","errorData","message","code","status","logout","removeItem","value","Provider"],"sources":["/Users/leonardorocha/Documents/TCC/projeto/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport { api } from '../services/api';\n\nconst AuthContext = createContext();\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth deve ser usado dentro de um AuthProvider');\n  }\n  return context;\n}\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n\n      setUser({ token });\n    }\n    setLoading(false);\n  }, []);\n\n  const login = async (email, senha) => {\n    try {\n      const response = await api.post('/auth/login', { email, senha });\n      const { token, usuario } = response.data;\n\n      localStorage.setItem('token', token);\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      setUser({ ...usuario, token });\n\n      return { success: true };\n    } catch (error) {\n      let errorMessage = 'Erro ao fazer login';\n\n\n      if (error.isHtmlResponse || (error.response?.data && typeof error.response.data === 'string' && error.response.data.trim().startsWith('<!'))) {\n        errorMessage = 'API retornou HTML ao invés de JSON. Verifique a URL base e o endpoint.';\n        console.error('❌ Erro: API retornou HTML. URL:', error.config?.url);\n        console.error('❌ Base URL:', api.defaults.baseURL);\n      } else if (error.response?.data) {\n        const errorData = error.response.data;\n        if (typeof errorData === 'string') {\n          errorMessage = errorData;\n        } else if (errorData && typeof errorData === 'object') {\n          errorMessage = errorData.message || errorData.error || 'Erro de conexão com o servidor';\n        } else {\n          errorMessage = 'Erro de conexão com o servidor';\n        }\n      } else if (error.message && typeof error.message === 'string') {\n        errorMessage = error.message;\n      } else if (error.code === 'ECONNABORTED') {\n        errorMessage = 'Timeout ao conectar com o servidor. Verifique sua conexão.';\n      } else if (!error.response) {\n        errorMessage = 'Não foi possível conectar ao servidor. Verifique a URL da API.';\n      }\n\n      console.error('❌ Erro no login:', {\n        message: error.message,\n        response: error.response?.data,\n        status: error.response?.status,\n        url: error.config?.url,\n        baseURL: api.defaults.baseURL\n      });\n\n      return {\n        success: false,\n        message: errorMessage\n      };\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    delete api.defaults.headers.common['Authorization'];\n    setUser(null);\n  };\n\n  const value = {\n    user,\n    login,\n    logout,\n    loading\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}